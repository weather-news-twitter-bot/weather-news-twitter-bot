name: ğŸ”„ Weather News Hourly Checker

on:
  schedule:
    # JST 19:00 (UTC 10:00) ã‹ã‚‰ ç¿Œæ—¥ JST 17:00 (UTC 8:00) ã¾ã§1æ™‚é–“æ¯ã«å®Ÿè¡Œ
    - cron: '0 10-23,0-8 * * *' 
  workflow_dispatch:

jobs:
  check_and_update:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: ğŸ“¦ Download Previous Schedule Artifact
      # åˆå›æŠ•ç¨¿ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
      uses: actions/download-artifact@v4
      with:
        name: latest-schedule-data
        path: . # ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã« schedule_data.json ãŒé…ç½®ã•ã‚Œã‚‹
        
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies and Playwright Browsers
      run: |
        pip install -r requirements.txt
        playwright install chromium
        playwright install-deps

    - name: ğŸ”„ Run Checker Bot
      env:
        # Twitter API Keys (GitHub Secrets)
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        # Bot Settings
        EXECUTION_MODE: 'check' # ç›£è¦–ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
        TZ: 'Asia/Tokyo'
      run: python src/weather_bot.py
      
    - name: â¬†ï¸ Re-Upload Updated Schedule Artifact
      # ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæ›´æ–°ã—ãŸ schedule_data.json ã‚’Artifactã«ä¸Šæ›¸ãä¿å­˜
      uses: actions/upload-artifact@v4
      with:
        name: latest-schedule-data
        path: schedule_data.json
        overwrite: true # â˜…é‡è¦ãªè¨­å®š: å¤‰æ›´å¾Œã®çŠ¶æ…‹ã‚’ä¸Šæ›¸ãã—ã¦å†æ¤œå‡ºã‚’é˜²ã
        retention-days: 1
