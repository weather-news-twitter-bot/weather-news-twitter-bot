name: ğŸ“… Weather News Bot (Initial Post)

on:
  schedule:
    # æ¯æ—¥ JST 18:15 (UTC 09:00) ã«å®Ÿè¡Œ
    - cron: '15 9 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯
    inputs:
      mode: 
        description: 'å¯¾è±¡æ—¥ã®æ±ºå®šãƒ¢ãƒ¼ãƒ‰ (auto: 18æ™‚ä»¥é™ã¯ç¿Œæ—¥)'
        required: true
        default: 'auto'
        type: choice
        options:
        - auto
        - today
        - tomorrow
      dry_run:
        description: 'å‹•ä½œç¢ºèªãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã¨æŠ•ç¨¿ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰'
        required: true
        default: false
        type: boolean

jobs:
  post_schedule:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    permissions:
      contents: write
      
    steps:
    - name: Checkout repository (with full history)
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies and Playwright Browsers
      run: |
        pip install -r requirements.txt
        playwright install chromium
        playwright install-deps

    - name: ğŸ“¢ Run Post Mode
      env:
        # Twitter API Keys (GitHub Secrets)
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        # Bot Settings
        EXECUTION_MODE: 'post'
        SCHEDULE_TARGET_MODE: ${{ github.event.inputs.mode }}
        SKIP_TWEET_FLAG: ${{ github.event.inputs.dry_run }}
        TZ: 'Asia/Tokyo'
      run: python src/weather_bot.py
      
    - name: ğŸ’¾ Commit and Push Schedule Data to Repo
      if: success() && github.event.inputs.dry_run != 'true'
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "BOT: Initial post schedule data commit"
        file_pattern: schedule_data.json
