name: ğŸ“º Weather News Bot (Initial Post)

on:
  schedule:
    # æ¯æ—¥ JST 18:00 (UTC 9:00) ã«å®Ÿè¡Œ
    - cron: '0 9 * * *'
  workflow_dispatch:
    inputs:
      target_mode:
        description: 'å¯¾è±¡æ—¥ãƒ¢ãƒ¼ãƒ‰ (auto, today, tomorrow)'
        required: true
        default: 'auto'
      
jobs:
  post_schedule:
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    - name: Install dependencies and Playwright Browsers
      run: |
        pip install -r requirements.txt
        playwright install chromium
        playwright install-deps

    - name: âš™ï¸ Run Weather News Bot (Normal Mode)
      env:
        # Twitter API Keys (GitHub Secrets)
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        # Bot Settings
        SCHEDULE_TARGET_MODE: ${{ github.event.inputs.target_mode || 'auto' }}
        EXECUTION_MODE: 'normal'
        TZ: 'Asia/Tokyo'
      run: python src/weather_bot.py

    - name: ğŸ“¦ Save Initial Schedule Artifact
      uses: actions/upload-artifact@v4
      with:
        name: latest-schedule-data  # ç›£è¦–ç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¨å…±é€šã®åå‰
        path: schedule_data.json
        overwrite: true
        retention-days: 1 # 1æ—¥ä¿æŒã™ã‚Œã°ååˆ†
