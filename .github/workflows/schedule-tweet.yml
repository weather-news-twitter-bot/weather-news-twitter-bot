name: ğŸ“… Weather News Bot (Initial Post)

on:
  schedule:
    # æ¯æ—¥ JST 18:00 (UTC 09:00) ã«å®Ÿè¡Œ
    - cron: '0 9 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã‚’è¨±å¯

jobs:
  post_schedule:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    # ğŸš¨ å¿…é ˆ: ãƒªãƒã‚¸ãƒˆãƒªã¸ã®ãƒ—ãƒƒã‚·ãƒ¥æ¨©é™
    permissions:
      contents: write
      
    steps:
    - name: Checkout repository (with full history)
      uses: actions/checkout@v4
      with:
        # å±¥æ­´å…¨ä½“ã‚’å–å¾—ã—ãªã„ã¨ã€ã‚³ãƒŸãƒƒãƒˆãŒå¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚
        fetch-depth: 0

    # -------------------------------------------------------------
    # 1. Pythonã®ç’°å¢ƒæ§‹ç¯‰
    # -------------------------------------------------------------
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: Install dependencies and Playwright Browsers
      run: |
        pip install -r requirements.txt
        playwright install chromium
        playwright install-deps

    # -------------------------------------------------------------
    # 2. åˆå›æŠ•ç¨¿ãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè¡Œ (ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ & ãƒ„ã‚¤ãƒ¼ãƒˆ)
    # -------------------------------------------------------------
    - name: ğŸ“¢ Run Initial Post Bot
      env:
        # Twitter API Keys (GitHub Secrets)
        TWITTER_API_KEY: ${{ secrets.TWITTER_API_KEY }}
        TWITTER_API_SECRET: ${{ secrets.TWITTER_API_SECRET }}
        TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
        TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
        # Bot Settings
        EXECUTION_MODE: 'post' # åˆå›æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œ
        TZ: 'Asia/Tokyo'
      run: python src/weather_bot.py
      
    # -------------------------------------------------------------
    # 3. çŠ¶æ…‹ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ (Artifactsã®ä»£æ›¿)
    # -------------------------------------------------------------
    - name: ğŸ’¾ Commit and Push Schedule Data to Repo
      # Pythonã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒæˆåŠŸã—ãŸå ´åˆã®ã¿å®Ÿè¡Œ
      if: success()
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "BOT: Initial post schedule data commit"
        # files -> file_pattern ã«ä¿®æ­£
        file_pattern: schedule_data.json
